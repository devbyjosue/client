<div class="info-container p-4 md:p-8 bg-white min-h-screen w-screen gap-4 flex flex-col">
  <div class=" w-full flex justify-end">
    <dx-button 
      icon="add"
      (click)="openAddForm()">
    </dx-button>
  </div>
  <div class=" rounded-lg overflow-hidden w-full">
      <dx-data-grid
          #dataGrid
          [dataSource]="dataSource()" 
          [columns]="columnConfigurations()"
          [keyExpr]="gridKeyField()" 
          [showBorders]="false"
          [showColumnLines]="false"
          [hoverStateEnabled]="true"
          [rowAlternationEnabled]="true"
          (onRowRemoving)="onRowRemoving($event)"
          (onCellPrepared)="onCellPrepared($event)"
          class="w-full"
      >
          <dxo-master-detail
              [enabled]="true"
              template="detailGridTemplate"
          ></dxo-master-detail>

          <div *dxTemplate="let salesOrder of 'detailGridTemplate'">
              <dx-data-grid
                  [dataSource]="getDetailGridDataSource()"
                  [columns]="detailColumnConfigurations()"
                  [keyExpr]="'salesOrderDetailID'"
              >
                  <dxo-paging [pageSize]="5"></dxo-paging>
              </dx-data-grid>
          </div>
          
          <dxo-paging [pageSize]="10"></dxo-paging>
          <dxo-pager
              [showPageSizeSelector]="true"
              [allowedPageSizes]="[5, 10, 20]"
              [showInfo]="true">
          </dxo-pager>

          <dxo-editing 
              mode="row" 
              [allowDeleting]="true"
              [allowUpdating]="true"
              [useIcons]="true">
          </dxo-editing>
      </dx-data-grid>
  </div>
</div>

<dx-popup 
  [visible]="isFormPopupVisible()" 
  [title]="'Sales Order Form'"
  [width]="1280"
  [height]="'auto'"
  (onHiding)="cancelForm()">
  
  <div *dxTemplate="let data of 'content'">
      <form (submit)="handleFormSubmit($event)">
          <dx-form
              #dxForm
              [formData]="formData()"
              [colCount]="3"
          >
              <dxi-item 
                  dataField="Customer"
                  editorType="dxSelectBox"
                  [editorOptions]="{
                      dataSource: ['Customer A', 'Customer B', 'Customer C', 'Customer D', 'Customer E'],
                      placeholder: 'Select a Customer',
                      searchEnabled: true
                  }"
                  [validationRules]="[{ type: 'required', message: 'Customer is required' }]">
              </dxi-item>
              <dxi-item dataField="salesOrderNumber" [validationRules]="[{ type: 'required' }]"></dxi-item>
              <dxi-item dataField="purchaseOrderNumber" [validationRules]="[{ type: 'required' }]"></dxi-item>
              <dxi-item dataField="accountNumber" [validationRules]="[{ type: 'required' }]"></dxi-item>
              <dxi-item dataField="comment" [colSpan]="2"></dxi-item>
              
              <dxi-item itemType="group" caption="Products" [colSpan]="3">
                  <dxi-item itemType="group" [colCount]="4">
                    <dxi-item 
                    [dataField]="'Product'" 
                    editorType="dxSelectBox"
                    [editorOptions]="{
                        dataSource: ['Product A', 'Product B', 'Product C', 'Product D', 'Product E'],
                        placeholder: 'Select product',
                        searchEnabled: true,
                        value: currentSelectedProduct(),
                        onValueChanged: onProductValueChanged

                    }"
                    [validationRules]="[{ type: 'required' }]">
                </dxi-item>
                <dxi-item
                    [dataField]="'Quantity'"
                    editorType="dxNumberBox"
                    [editorOptions]="{
                        format: '#', 
                        step: 1, 
                        min: 1, 
                        placeholder: '1',
                        value: currentSelectedQuantity(),
                        onValueChanged: onQuantityValueChanged
                        }"
                    [validationRules]="[{ type: 'required' }, { type: 'numeric' }]">
                </dxi-item>
                  <dxi-item type="empty"></dxi-item>
                  <dxi-item itemType="button" [buttonOptions]="buttonOptions()"></dxi-item>
                      <!-- <dxi-item itemType="button" [buttonOptions]="removeButtonOptions()"></dxi-item> -->
                  </dxi-item>
                  
                  
              </dxi-item>
          </dx-form>
          
          <dx-data-grid 
          [dataSource]="confirmationDetails()" 
          [showBorders]="false"
          >
            <dxi-column dataField="product" caption="Product"></dxi-column>
            <dxi-column dataField="quantity" caption="Quantity"></dxi-column>
            <dxi-column dataField="unitPrice" caption="Unit Price" format="currency"></dxi-column>
            <dxi-column dataField="total" caption="Total" format="currency"></dxi-column>
          </dx-data-grid>
          <div class="mt-4 font-bold text-right">Total Due: {{ confirmationTotal() | currency }}</div>

          <div class="mt-6 flex justify-end gap-2">
              <dx-button text="Cancel" (onClick)="cancelForm()"></dx-button>
              <dx-button text="Save" type="success" [useSubmitBehavior]="true"></dx-button>
          </div>
      </form>
  </div>
</dx-popup>

